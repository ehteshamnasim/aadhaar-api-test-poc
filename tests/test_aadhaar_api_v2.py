"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      AI-GENERATED API TEST SUITE                               â•‘
â•‘                      Powered by CodeLlama 70B via Ollama                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ GENERATION SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¤– AI Model:              CodeLlama 70B
ğŸ“… Generated:             2025-10-16 20:39:29
ğŸ“‚ Version:               v2
ğŸ”– Spec Hash:             a0262bc73c3526080b676d4b...
ğŸ“ Spec File:             aadhaar-api.yaml

ğŸ“Š API SPECIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŒ Base URL:              http://localhost:5001/api/v1
ğŸ“¡ Total Endpoints:       2

Endpoints Covered:
  1. POST   /aadhaar/verify
  2. POST   /aadhaar/demographics

ğŸ§ª TEST SUITE DETAILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Total Test Functions:   6
âœ“ Test Framework:         pytest
âœ“ Coverage Tool:          coverage.py
âœ“ Coverage Target:        â‰¥85%

ğŸ“ TEST SCENARIOS INCLUDED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Each endpoint is tested with multiple scenarios:
  â€¢ Happy Path Tests      - Valid inputs, expected 200 responses
  â€¢ Error Handling        - Invalid inputs, missing fields, malformed data
  â€¢ Edge Cases            - Boundary values, special characters
  â€¢ Status Code Validation - 200, 400, 403, 404, 422, 429, 500
  â€¢ Response Schema       - JSON structure validation
  â€¢ Business Logic        - Domain-specific rules

âš ï¸  IMPORTANT NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- AUTO-GENERATED: This file is automatically generated. Manual edits are preserved
  in version history but will be overwritten on regeneration.

- VERSIONING: Each spec change creates a new versioned file (v2, v3, etc.)
  - Always run the latest version for accurate results
  - Previous versions are kept for historical reference

- API DEPENDENCY: Tests require the dummy API to be running:
  - Start with: python3 api/dummy_aadhaar_api.py
  - Verify health: curl http://localhost:5001/health

- SPEC CHANGES: When the OpenAPI spec changes:
  1. Commit the updated spec
  2. POC automatically regenerates tests
  3. New versioned file is created
  4. Tests reflect latest spec

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""


import pytest
import requests

def test_aadhaar_demographics_invalid_consent(session):
    """
    Test retrieval of demographic details with invalid consent value.
    """
    payload = {
        'aadhaar_number': '123456789012',
        'consent': "invalid"
    }
    response = session.post(f"{BASE_URL}/aadhaar/demographics", json=payload)
    assert response.status_code == 400
    assert isinstance(response.json(), dict)


def test_aadhaar_demographics_missing_field(session):
    """
    Test retrieval of demographic details with missing field.
    """
    payload = {
        'consent': True
    }
    response = session.post(f"{BASE_URL}/aadhaar/demographics", json=payload)
    assert response.status_code == 400
    assert isinstance(response.json(), dict)


def test_aadhaar_demographics_success(session):
    """
    Test successful retrieval of demographic details.
    """
    payload = {
        'aadhaar_number': '123456789012',
        'consent': True
    }
    response = session.post(f"{BASE_URL}/aadhaar/demographics", json=payload)
    assert response.status_code == 200
    assert isinstance(response.json(), dict)


def test_aadhaar_demographics_unauthorized_access(session):
    """
    Test retrieval of demographic details with unauthorized access.
    """
    payload = {
        'aadhaar_number': '123456789012',
        'consent': False
    }
    response = session.post(f"{BASE_URL}/aadhaar/demographics", json=payload)
    assert response.status_code == 403
    assert isinstance(response.json(), dict)

def test_aadhaar_verify_missing_field(session):
    """
    Test verification of Aadhaar number with missing field.
    """
    payload = {}
    response = session.post(f"{BASE_URL}/aadhaar/verify", json=payload)
    assert response.status_code == 400
    assert isinstance(response.json(), dict)


def test_aadhaar_verify_success(session):
    """
    Test successful verification of Aadhaar number.
    """
    payload = {
        'aadhaar_number': '123456789012'
    }
    response = session.post(f"{BASE_URL}/aadhaar/verify", json=payload)
    assert response.status_code == 200
    assert isinstance(response.json(), dict)


